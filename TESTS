This file gives information on the tests that were made during the
Automake migration.

Environment
-----------
Arch Linux x64 with:
  - Autoconf 2.69
  - Automake 1.14.1
  - GNU Make 4.0

Current status
--------------
  - Gnulib integrated
  - Minimum Automake support
  - Build src/libs/*
  - Build src/utils/*
  - Build src/preproc/*

Tests
-----

1. Generation of build system files

./bootstrap

Generated the following files and directories:
  INSTALL
  Makefile.in
  aclocal.m4
  autom4te.cache/
  build-aux/
  configure
  gnulib_m4/
  lib/
  src/include/config.hin

2. Build of various targets

Tests done in 2 configurations:

  - Out-of source build mode

    mkdir build
    cd build
    ../configure

  - In source build:
    ../configure

2.1 make

Following files are generated:

  - src/include/config.h
  - lib/libgnu.a

from arch/misc:
  - shdeps.sed

from src/libs:
  - libbib.a
  - libdriver.a
  - libgroff.a, version.cpp and extra files (charset.alias,
    ref-add.sed, ref-del.sed)
  - libxutils.a

from src/utils:
  - addftinfo
  - afmtodit
  - hpftodit
  - indxbib
  - lkbib
  - lookbib
  - pfbtops
  - tfmtodit
  - xtotroff
  - man files (.n) in src/utils

from src/preproc:
  - eqn
  - grn
  - pre-grohtml
  - pic
  - preconv
  - refer
  - soelim
  - tbl
  - Yacc and Lex support: the following files are generated:
    -- eqn/eqn.cpp
    -- eqn/eqn.hpp (previously eqn_tab.h)
    -- pic/pic.cpp
    -- pic/pic.hpp (previously pic_tab.h)
    -- pic/pic.output
    -- refer/label.cpp
    -- refer/label.hpp
    Compared to the previous build system, the only relevant diff is
    an extra protection #define in label.cpp
#ifndef YY_YY_SRC_PREPROC_REFER_LABEL_HPP_INCLUDED
# define YY_YY_SRC_PREPROC_REFER_LABEL_HPP_INCLUDED

from src/devices:
  - grodvi
  - pre-grohtml
  - post-grohtml
  - grolbp
  - grolj4
  - gropdf
  - pdfmom
  - grops
  - grotty
  - gxditview

In order to check and improve the dependencies, the following targets
were built from a clean environment:
  - make lib/libgnu.a
  - make libbib.a
  - make libdriver.a
  - make libgroff.a
  - make libxutil.a
  - make addftinfo
  - make  afmtodit
  - make hpftodit
  - make indxbib
  - make lkbib
  - make lookbib
  - make pfbtops
  - make tfmtodit
  - make xtotroff
  - make eqn
  - make grn
  - make pre-grohtml
  - make pic
  - make preconv
  - make refer
  - make soelim
  - make tbl
  - make grodvi
  - make post-grohtml
  - make grolbp
  - make grolj4
  - make gropdf
  - make pdfmom
  - make grops
  - make grotty
  - make gxditview

2.2 make clean

TODO: src/devices

The following files remain (this is expected):
  - Makefile
  - config.status
  - config.log
  - src/include/config.h
  - src/include/stamp-h1
  - .deps directories and .dirstamp files

  - .n files, afmtodit are cleaned
  - shdeps.sed is cleaned
  - binaries from bin_PROGRAMS are cleaned

2.3 make mostlyclean

TODO: src/devices

  Like 'make clean', but the following files also remain (expected):
  - lib*.a
  - libgroff.a's charset.alias, ref-add.sed, ref-del.sed, and
    version.cpp.
  - gnulib's charset.alias, ref-add.sed, ref-del.sed and configmake.h

Differences with former build system:

  - Programs (listed in bin_PROGRAMS) are not cleaned by 'make
    mostlyclean'. This could be changed if needed (MOSTLYCLEANFILES +=
    $(bin_PROGRAMS)).

2.4 make distclean

  Like 'make clean', but the following files are also cleaned:
  - Makefile
  - config.status
  - config.log
  - src/include/config.h
  - src/include/stamp-h1
  - .deps directories and .dirstamp files

  In a out-of-source build, nothing remains in the build directory
  expect empty directories.

  The files generated by bootstrap and needed by the configure script
  are untouched:
  INSTALL
  Makefile.in
  aclocal.m4
  build-aux/
  configure
  gnulib_m4/
  lib/
  src/include/config.hin

2.5 make maintainer-clean

  Like 'make distclean'

2.6 make install

TODO: src/devices specific rules

  mkdir -p ~/tmp/automake
  make install DESTDIR=~/tmp/automake

  - If file charset.alias is always present in
    $(DESTDIR)/usr/local/lib, make install update it by adding 'groff'
    to the list of programs using it. Otherwise nothing is installed.
  - programs from src/utils are installed in $(DESTDIR)/usr/local/bin
  - man files from src/utils are installed in $(DESTDIR)/usr/local/share/man/man1
  - $(DESTDIR)/usr/local/share/groff/1.22/eign (from src/utils/indxbib)

2.7 make uninstall

TODO: src/devices specific rules
  
  Removes:

  - $(DESTDIR)/usr/local/lib/charset.alias if exists
  - $(DESTDIR)/usr/local/bin/*
  - $(DESTDIR)/usr/local/man/man1/*
  - $(DESTDIR)/usr/local/share/groff/1.22.3/eign
  - $(DESTDIR)/usr/local/share/groff/1.22.3/
  - $(DESTDIR)/usr/local/share/groff/
  
2.8 make dist

  groff-1.22.3.tar.gz is generated.

  - Files/directories that are not distributed on purpose:
    .gitignore
    .gitmodules
    bootstrap
    bootstrap.conf
    gnulib/
    README.git
    TESTS

  - Missing files/directories (TODO):
    contrib/
    doc/
    font/
    man/
    src/devices
    src/include (except config.hin and include.am)
    src/roff
    tmac
    test-groff.in

  - Files/directories not present in the git tree that are
    distributed:
    build-aux/
    gnulib_m4/
    lib/
    src/include/config.hin
    INSTALL
    Makefile.in
    aclocal.m4
    configure   
    src/preproc/eqn/eqn.cpp
    src/preproc/eqn/eqn.hpp
    src/preproc/pic/pic.cpp
    src/preproc/pic/pic.hpp 
    src/preproc/refer/label.hpp
    src/preproc/refere/label.cpp
    
2.9 make distcheck
  
  - configure fails: src/roff/groff/groff.cpp is missing (passed to
    AC_CONFIG_SRCDIR macro)

Notes
-----

  - Gnulib: some files of src/libs/libgroff could be replaced by their
    gnulib equivalent
